# üöÄ **PhotoSync Backend ‚Äì 1-Page Deployment Cheat Sheet**

### Laravel 12 ‚Üí Google Cloud Run (Ultra-Short Edition)

---

## ‚úÖ **1. Clone & Setup Laravel**

```bash
git clone https://github.com/ettersAy/photosync.git
cd photosync
cp .env.example .env
php artisan key:generate --show   # copy the key
```

---

## ‚úÖ **2. Configure Neon DB (`.env`)**

Use the **DIRECT** Neon host.

```env
DB_CONNECTION=pgsql
DB_HOST=<neon-direct-host>
DB_PORT=5432
DB_DATABASE=photosync_db
DB_USERNAME=neondb_owner
DB_PASSWORD=<password>
DB_SSLMODE=require
```

Run migrations:

```bash
php artisan migrate
```

---

## ‚úÖ **3. Build Image**

```bash
./scripts/deploy/build.sh
```

(Uses Cloud Build ‚Üí Artifact Registry)

---

## ‚úÖ **4. FIRST Deploy (set env vars)**

```bash
gcloud run deploy photosync-backend \
  --image us-central1-docker.pkg.dev/photosync-backend-479418/photosync-repo/photosync-app \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars APP_ENV=production \
  --set-env-vars APP_DEBUG=false \
  --set-env-vars APP_KEY="base64:xxxxx=" \
  --set-env-vars DB_CONNECTION=pgsql \
  --set-env-vars DB_HOST=<neon-direct-host> \
  --set-env-vars DB_PORT=5432 \
  --set-env-vars DB_DATABASE=photosync_db \
  --set-env-vars DB_USERNAME=neondb_owner \
  --set-env-vars DB_PASSWORD=<password> \
  --set-env-vars DB_SSLMODE=require
```

(Env vars persist in Cloud Run.)

---

## ‚úÖ **5. Subsequent Deploys (super fast)**

```bash
./scripts/deploy/build.sh
./scripts/deploy/deploy.sh
```

---

## ‚úÖ **6. Verify Backend**

```bash
./scripts/deploy/check.sh
```

Or manually:

```bash
curl https://<cloud-run-url>/api/messages
```

---

## ‚ùó Most Common Issues

| Problem              | Fix                                          |
| -------------------- | -------------------------------------------- |
| 500 on all routes    | DB host/SSL wrong or missing APP_KEY         |
| `SQLSTATE[08006]`    | Wrong Neon host (use DIRECT), wrong password |
| Timeout              | Neon SSL misconfigured                       |
| Env vars not applied | Re-deploy with full `--set-env-vars` once    |
