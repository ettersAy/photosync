# Test Case Specification: US-005 Create API Endpoint Contact Us

## Overview
This document contains comprehensive test cases for the Contact Us API endpoints implemented in US-005. The API provides endpoints for storing contact messages and retrieving them.

## API Endpoints
- **POST** `/api/messages` - Store a new contact message
- **GET** `/api/messages` - Retrieve all messages

## Test Environment Setup
- **Base URL**: `http://localhost:8000/api`
- **Content-Type**: `application/json`
- **Authentication**: None required

---

## Test Cases for POST `/api/messages`

### TC-001: Successful Message Creation with Email
**Description**: Test successful creation of a contact message with valid email and message

**Preconditions**:
- API server is running
- Database is accessible

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "test@example.com",
     "msg": "This is a test message for the contact form."
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**:
  ```json
  {
    "ok": true,
    "id": <generated_message_id>
  }
  ```
- **Database**: New record created in `messages` table with provided email and message

---

### TC-002: Successful Message Creation without Email
**Description**: Test successful creation of a contact message with only required message field

**Preconditions**:
- API server is running
- Database is accessible

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "msg": "This is a test message without email."
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**:
  ```json
  {
    "ok": true,
    "id": <generated_message_id>
  }
  ```
- **Database**: New record created in `messages` table with null email and provided message

---

### TC-003: Missing Required Message Field
**Description**: Test validation error when required message field is missing

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "test@example.com"
   }
   ```

**Expected Results**:
- **Status Code**: 422 Unprocessable Entity
- **Response Body**: Contains validation error for missing `msg` field
- **Database**: No new record created

---

### TC-004: Invalid Email Format
**Description**: Test validation error when email format is invalid

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "invalid-email",
     "msg": "This is a test message."
   }
   ```

**Expected Results**:
- **Status Code**: 422 Unprocessable Entity
- **Response Body**: Contains validation error for invalid email format
- **Database**: No new record created

---

### TC-005: Message Field Too Long
**Description**: Test validation error when message exceeds maximum length

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body with message exceeding 5000 characters

**Expected Results**:
- **Status Code**: 422 Unprocessable Entity
- **Response Body**: Contains validation error for message length exceeding 5000 characters
- **Database**: No new record created

---

### TC-006: Empty Message Field
**Description**: Test validation error when message field is empty

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "test@example.com",
     "msg": ""
   }
   ```

**Expected Results**:
- **Status Code**: 422 Unprocessable Entity
- **Response Body**: Contains validation error for empty message
- **Database**: No new record created

---

### TC-007: Message with Special Characters
**Description**: Test successful creation with message containing special characters

**Preconditions**:
- API server is running
- Database is accessible

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "test@example.com",
     "msg": "Message with special chars: !@#$%^&*()_+-=[]{}|;:,.<>?`~"
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**:
  ```json
  {
    "ok": true,
    "id": <generated_message_id>
  }
  ```
- **Database**: New record created with special characters preserved

---

### TC-008: Message with Unicode Characters
**Description**: Test successful creation with message containing Unicode characters

**Preconditions**:
- API server is running
- Database is accessible

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body:
   ```json
   {
     "email": "test@example.com",
     "msg": "Message with Unicode: ‰Ω†Â•Ω‰∏ñÁïå üåç üöÄ"
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**:
  ```json
  {
    "ok": true,
    "id": <generated_message_id>
  }
  ```
- **Database**: New record created with Unicode characters preserved

---

## Test Cases for GET `/api/messages`

### TC-009: Retrieve All Messages (Empty Database)
**Description**: Test retrieving messages when database is empty

**Preconditions**:
- API server is running
- `messages` table is empty

**Test Steps**:
1. Send GET request to `/api/messages`

**Expected Results**:
- **Status Code**: 200 OK
- **Response Body**:
  ```json
  {
    "ok": true,
    "data": []
  }
  ```

---

### TC-010: Retrieve All Messages (With Data)
**Description**: Test retrieving messages when database contains records

**Preconditions**:
- API server is running
- `messages` table contains multiple records

**Test Steps**:
1. Send GET request to `/api/messages`

**Expected Results**:
- **Status Code**: 200 OK
- **Response Body**:
  ```json
  {
    "ok": true,
    "data": [
      {
        "id": 1,
        "email": "test1@example.com",
        "msg": "First message",
        "created_at": "2025-01-01T00:00:00.000000Z",
        "updated_at": "2025-01-01T00:00:00.000000Z"
      },
      {
        "id": 2,
        "email": null,
        "msg": "Second message without email",
        "created_at": "2025-01-01T00:00:01.000000Z",
        "updated_at": "2025-01-01T00:00:01.000000Z"
      }
    ]
  }
  ```
- **Order**: Messages should be ordered by `created_at` in descending order

---

### TC-011: CORS Headers Verification
**Description**: Test that CORS headers are properly set for frontend access

**Preconditions**:
- API server is running

**Test Steps**:
1. Send OPTIONS request to `/api/messages`
2. Include Origin header: `https://example.vercel.app`

**Expected Results**:
- **Status Code**: 200 OK
- **Headers**: Contains appropriate CORS headers allowing the origin
- **Access-Control-Allow-Origin**: Should include the requested origin or `*`

---

## Edge Cases

### TC-012: SQL Injection Attempt
**Description**: Test that SQL injection attempts are properly handled

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body with SQL injection attempt:
   ```json
   {
     "email": "test@example.com",
     "msg": "'; DROP TABLE messages; --"
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**: Normal success response
- **Database**: Message stored as plain text, no SQL execution

---

### TC-013: XSS Attempt
**Description**: Test that XSS attempts are properly handled

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body with XSS attempt:
   ```json
   {
     "email": "test@example.com",
     "msg": "<script>alert('XSS')</script>"
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**: Normal success response
- **Database**: Message stored as plain text, no script execution

---

### TC-014: Large Email Address
**Description**: Test with very long but valid email address

**Preconditions**:
- API server is running

**Test Steps**:
1. Send POST request to `/api/messages`
2. Set Content-Type header to `application/json`
3. Send request body with long email:
   ```json
   {
     "email": "very.long.email.address.that.is.still.valid@example.com",
     "msg": "Test message"
   }
   ```

**Expected Results**:
- **Status Code**: 201 Created
- **Response Body**: Normal success response
- **Database**: Message stored with long email address

---

## Performance Tests

### TC-015: Concurrent Message Creation
**Description**: Test handling of concurrent message creation requests

**Preconditions**:
- API server is running
- Database is accessible

**Test Steps**:
1. Send 10 concurrent POST requests to `/api/messages`
2. Each request with unique email and message

**Expected Results**:
- **Status Codes**: All requests return 201 Created
- **Database**: All 10 messages created successfully
- **IDs**: All message IDs should be unique

---

### TC-016: High Volume Message Retrieval
**Description**: Test performance of retrieving large number of messages

**Preconditions**:
- API server is running
- Database contains 1000+ messages

**Test Steps**:
1. Send GET request to `/api/messages`

**Expected Results**:
- **Status Code**: 200 OK
- **Response Time**: Should be reasonable (< 2 seconds)
- **Response Body**: Contains all messages in correct order

---

## Test Data Requirements

### Sample Test Messages
```json
[
  {
    "email": "user1@example.com",
    "msg": "Regular inquiry about services"
  },
  {
    "email": null,
    "msg": "Anonymous feedback"
  },
  {
    "email": "user2@example.com",
    "msg": "Question about pricing and features"
  }
]
```

### Invalid Test Data
```json
[
  {
    "email": "invalid-email",
    "msg": "Valid message"
  },
  {
    "email": "test@example.com",
    "msg": ""
  },
  {
    "email": "test@example.com"
  }
]
```

## Test Execution Notes

1. **Environment**: Ensure Laravel application is running with proper database connection
2. **Database**: Use test database or ensure proper cleanup between tests
3. **Headers**: Always set `Content-Type: application/json` for POST requests
4. **CORS**: Verify CORS configuration allows requests from frontend origins
5. **Validation**: Test both success and failure scenarios for comprehensive coverage

## Success Criteria

- All test cases pass with expected status codes and response formats
- Database operations complete successfully without data corruption
- Validation rules are properly enforced
- CORS headers allow frontend access from configured origins
- Performance meets acceptable standards for concurrent operations
