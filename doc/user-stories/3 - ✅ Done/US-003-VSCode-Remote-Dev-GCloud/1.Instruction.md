# âœ… US-003: Enable Remote Development on Google Cloud Shell via VS Code

## Goal
Work on the `photosync` Laravel backend (stored inside Google Cloud Shell) directly from VS Code on a Linux Mint machine, with a stable SSH setup that continues working across days, reboots, and Cloud Shell VM refreshes.

---

## Actions & Commands

### 1. Install Google Cloud SDK globally (system-wide)

- Add required packages:
```bash
  sudo apt update && sudo apt install -y curl apt-transport-https ca-certificates gnupg
```

* Add Google Cloud GPG key:

  ```bash
  curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg \
  | sudo gpg --dearmor -o /usr/share/keyrings/cloud.google.gpg
  ```

* Add Google Cloud SDK repository:

  ```bash
  echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" \
  | sudo tee /etc/apt/sources.list.d/google-cloud-sdk.list
  ```

* Install SDK:

  ```bash
  sudo apt update
  sudo apt install -y google-cloud-sdk
  ```

---

### 2. Authenticate and set correct GCP project

* Login:

  ```bash
  gcloud auth login
  ```

* Set working project:

  ```bash
  gcloud config set project photosync-backend-479418
  ```

---

### 3. Correct SSH key permissions

```bash
chmod 600 ~/.ssh/google_compute_engine
chmod 644 ~/.ssh/google_compute_engine.pub
```

---

### 4. Test Cloud Shell direct SSH (first-time setup)

```bash
gcloud cloud-shell ssh
```

This creates your SSH keys and verifies connectivity.

---

### 5. Configure persistent SSH host for VS Code

**(New improved version using ProxyCommand â€” works even after IP changes)**

Open SSH config:

```bash
nano ~/.ssh/config
```

Add this block:

```
Host google-cloud-shell
  ProxyCommand gcloud cloud-shell ssh --ssh-flag='-W localhost:22'
  User etters_ayoub
  IdentityFile ~/.ssh/google_compute_engine
  StrictHostKeyChecking no
```

Save & close:

* `Ctrl + O`, Enter
* `Ctrl + X`

---

### 6. Test connection using new dynamic SSH configuration

```bash
ssh google-cloud-shell
```

Expected:

```
Waiting for your Cloud Shell machine to start...
Welcome to Cloud Shell!
etters_ayoub@cloudshell:~$
```

Exit session:

```bash
exit
```

---

### 7. Connect through VS Code Remote-SSH

1. Open VS Code
2. Install **Remote - SSH** extension
3. Press `Ctrl + Shift + P`
4. Choose: **Remote-SSH: Connect to Host...**
5. Select: `google-cloud-shell`
6. VS Code opens a remote window
7. Navigate to your folder:

   * `/home/etters_ayoub/photosync`
8. Develop like it's a local Laravel project

---

## Expected Outcomes

* **Stable SSH connection** to Cloud Shell (survives reboots, laptop closes, IP changes).
* VS Code Remote-SSH connects without needing manual fixes.
* `photosync` project is fully accessible and editable.
* Faster development workflow with no repeated reconfiguration needed.

---

ðŸ”š **User Story status:** Done

