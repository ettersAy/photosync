# US-010 : Frontend Deployment Guide â€“ Vue (Vite) â†’ Vercel

Repo: `ettersAy/photosync`
Frontend folder: `frontend/`
Backend API: Cloud Run URL (e.g. `https://photosync-backend-xxxxx-uc.a.run.app`)

Goal:
Deploy the Vue app to Vercel so:

* `https://photosync-frontend.vercel.app` (or similar) serves your SPA
* The **Contact Us** page uses your **Cloud Run URL** as `VITE_API_URL` in production

---

### ğŸ”¹ Step 1: Prepare the frontend project for Vercel

Make sure your Vue app builds locally.

In Cloud Shell:

```bash
cd ~/photosync/frontend
npm run build
```

* If it finishes without errors â†’ youâ€™re good.
* If errors appear, fix them before deploying (you can paste them to me if needed).

Commit if you changed anything:

```bash
cd ~/photosync
git add frontend
git commit -m "Prepare frontend for Vercel deployment"
git push origin main
```

---

### ğŸ”¹ Step 2: Create a Vercel project from your repo

1. Go to **vercel.com** and log in.
2. Click **â€œAdd Newâ€¦â€ â†’ â€œProjectâ€**
3. Choose **â€œImport Git Repositoryâ€**
4. Select your repo: `ettersAy/photosync`

Vercel will scan the repo and ask how to configure the project.

---

### ğŸ”¹ Step 3: Tell Vercel the **frontend folder**

Because your Vue app is not at the root but in `/frontend`:

1. Under **â€œRoot Directoryâ€** choose or enter:
   `frontend`
2. Click **â€œContinueâ€**.

Now Vercel will show build settings.

---

### ğŸ”¹ Step 4: Build settings (Vite + Vue)

Vercel usually auto-detects this, but ensure:

* **Framework Preset**: `Vite` or `Vue`
* **Build Command**:

  ```bash
  npm run build
  ```
* **Output Directory**:

  ```text
  dist
  ```
* **Install Command** (optional â€“ auto):

  ```bash
  npm install
  ```

You donâ€™t need to change `package.json` for Vercel; Vite defaults are fine.

---

### ğŸ”¹ Step 5: Set `VITE_API_URL` for production

In the Vercel project settings (you can do it during initial setup or after first deploy):

1. Go to **Project â†’ Settings â†’ Environment Variables**

2. Add a new variable:

   * **Name:** `VITE_API_URL`
   * **Value:** `https://<your-cloud-run-service>.run.app`

     * Example: `https://photosync-backend-xxxxx-uc.a.run.app`
   * **Environment:** `Production` (and optionally `Preview`)

3. Click **Save**.

> This will be used by `import.meta.env.VITE_API_URL` in `Contact.vue` during the build.

If you already had a `.env` file in `frontend` with a local URL (`http://localhost:8000`), thatâ€™s fine.
Vercel builds use the env var from **its** environment, not from your local `.env`.

---

### ğŸ”¹ Step 6: First deploy

Once:

* Repo connected
* Root directory set to `frontend`
* Env var `VITE_API_URL` set

Click **â€œDeployâ€** in the Vercel project.

Vercel will:

1. `git clone` your repo
2. `cd frontend`
3. `npm install`
4. `npm run build`
5. Serve the `dist` folder with their static hosting + SPA routing

If it succeeds, youâ€™ll see a URL like:

```text
https://photosync-frontend.vercel.app
```

(or some automatically generated URL).

---

### ğŸ”¹ Step 7: Test the deployed app

Open the Vercel URL in your browser:

1. You should see the **Dashboard** page.
2. Click **Contact Us**.
3. Submit a message.

Check devtools Network tab:

* **Request URL** should be `https://<your-cloud-run-service>.run.app/api/messages`
* **Status** should be `201 Created`
* If so â†’ ğŸ‰ you now have a fully deployed, end-to-end working Phase 1 app:

  * Vercel (frontend) â†’ Cloud Run (backend) â†’ Neon (DB)

---

### ğŸ”¹ Step 8: CORS (if you get CORS errors)

If you see a CORS error like:

> `Access to fetch at 'https://...run.app/api/messages' from origin 'https://...vercel.app' has been blocked by CORS policy`

You need to allow your Vercel domain in Laravel CORS config:

1. Open `config/cors.php` in your Laravel project.
2. Set:

```php
'paths' => ['api/*'],

'allowed_methods' => ['*'],

'allowed_origins' => [
    'https://*.vercel.app',
],

'allowed_headers' => ['*'],

'supports_credentials' => false,
```

3. Commit and rebuild/redeploy the backend image (Cloud Run):

```bash
cd ~/photosync
./scripts/deploy/build.sh
./scripts/deploy/deploy.sh
```

Then retry from Vercel.

---

### ğŸ”¹ Step 9: Future updates

Now that Vercel is connected to GitHub:

* Every `git push origin main` that affects `frontend/` will trigger an automatic rebuild and redeploy.
* No need to manually redeploy on Vercel.
